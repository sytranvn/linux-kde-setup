# Linux Kernel Development Environment setup

## Virtual machine

Create a virtual machine for safety. Create at least 50G virtual disk to store code. Because source code and build artifacts
can take 25-30GB.

## Environment

On development and test systems, it is a good idea to ensure there is ample space for kernels in the boot partition.
Choosing a whole disk install or setting aside 3 GB disk space for the boot partition is recommended.

	sudo apt-get install build-essential vim git cscope libncurses-dev libssl-dev bison flex

	sudo apt-get install git-email

Check [Minimal requirements to compile the Kernel](https://www.kernel.org/doc/html/latest/process/changes.html)

## Email

The next step is finding information on email clients and configuring your email client for sending patches and responding to emails.
Highly recommend using `git send-email` for sending patches.

    [sendemail]
        smtpserver = smtp.gmail.com
        smtpserverport = 587
        smtpencryption = tls
        smtpuser = <username>
        smtppass = <password>

Add above configuration in `.gitconfig` file and run 
    
    git send-email mypatch.patch

to send patches; `mypatch.patch` is generated by the `git format-patch` command.

### Things to remeber when email

- Bottom post
    Never top post in your response. Top posting is writing a message above the original text while sending a response to an email. 
    Add your response at the bottom of the original text. Bottom posting makes it easier to read and follow review comments on a patch.
- Inline post
    When reviewing or responding to a patch, deleting or stripping parts of the message you are not replying to is a good practice,
    and makes it easier to follow the responses in the thread.
- No HTML format
    Disable compose messages in HTML format. Patches sent using HTML format will be rejected
    by the development mailing lists automatically.
- No signatures
    Do not include private information in your signature.
    This is important for privacy reasons, as you are going to be posting to mailing lists.
- No attachments
    Do not send patches as attachments.
    In general, avoid attachments. Some exceptions are kernel logs or configuration files when reporting bugs.

Refer to [Email clients info for Linux](https://www.kernel.org/doc/html/latest/process/email-clients.html) for more details.
Generate an app-specific password for authentication if you have 2-factor on your Gmail account.

## Linux Kernel source
[The Linux Kernel Archives](https://www.kernel.org/)

### Linux mainline

Start by cloning Linus's tree which is called [Linux mainline](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/)

    cd /linux_work
    git clone git://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git linux_mainline
    cd linux_mainline; ls -h

### Explore the Sources

[cregit-Linux](https://cregit.linuxsources.org/)

### Explore the linux-kselftest Repository

    cd  /linux_work
    git clone git://git.kernel.org/pub/scm/linux/kernel/git/shuah/linux-kselftest.git
    cd linux-kselftest
    
    git branch -a
    
    git checkout next

## Building and Installing First Kernel

### Clone the Stable kernel git
    
    git clone git://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git -n
    cd linux-stable
    git branch -a | grep linux-6
    git checkout linux-5.19.y

Copy old kernel config file from `/boot/config-5.*` to source directory
    
    cp /boot/cofig-5.15.0-89-generic .config

Make sure to comment out 

    CONFIG_SYSTEM_TRUSTED_KEYS="debian/canoical-certs.pem"
    CONFIG_SYSTEM_REVOCATION_KEYS="debian/canonical-revoked-certs.pem"

config since it is debian specific config.

    make oldconfig


Hold enter to select all new default flags.

Start building.

    make -j4 all

    make modules_install install



